module.exports=[51211,36799,e=>{"use strict";var t,s,n,r,a,i,o,l,c,h,u,d,f,p,m,g,_,y,w,b,v,S,x,A,$,I,O,E,R,k,P,T,C,N,M,j,L,D,B,W,F,U,q,X,H,J,K,V,G,z,Y,Q,Z,ee,et,es,en,er,ea,ei,eo,el,ec,eh,eu,ed,ef,ep,em,eg,e_,ey,ew,eb,ev,eS;let ex,eA,e$,eI;function eO(e,t,s,n,r){if("m"===n)throw TypeError("Private method is not writable");if("a"===n&&!r)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s}function eE(e,t,s,n){if("a"===s&&!n)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}let eR=function(){let{crypto:e}=globalThis;if(e?.randomUUID)return eR=e.randomUUID.bind(e),e.randomUUID();let t=new Uint8Array(1),s=e?()=>e.getRandomValues(t)[0]:()=>255*Math.random()&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,e=>(e^s()&15>>e/4).toString(16))};function ek(e){return"object"==typeof e&&null!==e&&("name"in e&&"AbortError"===e.name||"message"in e&&String(e.message).includes("FetchRequestCanceledException"))}let eP=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e){try{if("[object Error]"===Object.prototype.toString.call(e)){let t=Error(e.message,e.cause?{cause:e.cause}:{});return e.stack&&(t.stack=e.stack),e.cause&&!t.cause&&(t.cause=e.cause),e.name&&(t.name=e.name),t}}catch{}try{return Error(JSON.stringify(e))}catch{}}return Error(e)};class eT extends Error{}class eC extends eT{constructor(e,t,s,n){super(`${eC.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.requestID=n?.get("x-request-id"),this.error=t,this.code=t?.code,this.param=t?.param,this.type=t?.type}static makeMessage(e,t,s){let n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e||!n)return new eM({message:s,cause:eP(t)});let r=t?.error;return 400===e?new eL(e,r,s,n):401===e?new eD(e,r,s,n):403===e?new eB(e,r,s,n):404===e?new eW(e,r,s,n):409===e?new eF(e,r,s,n):422===e?new eU(e,r,s,n):429===e?new eq(e,r,s,n):e>=500?new eX(e,r,s,n):new eC(e,r,s,n)}}class eN extends eC{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class eM extends eC{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class ej extends eM{constructor({message:e}={}){super({message:e??"Request timed out."})}}class eL extends eC{}class eD extends eC{}class eB extends eC{}class eW extends eC{}class eF extends eC{}class eU extends eC{}class eq extends eC{}class eX extends eC{}class eH extends eT{constructor(){super("Could not parse response content as the length limit was reached")}}class eJ extends eT{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}class eK extends Error{constructor(e){super(e)}}let eV=/^[a-z][a-z0-9+.-]*:/i,eG=e=>(eG=Array.isArray)(e),ez=eG;function eY(e){return"object"!=typeof e?{}:e??{}}function eQ(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}let eZ=e=>new Promise(t=>setTimeout(t,e)),e0="6.18.0",e1=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",e2=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";function e3(...e){let t=globalThis.ReadableStream;if(void 0===t)throw Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new t(...e)}function e4(e){let t=Symbol.asyncIterator in e?e[Symbol.asyncIterator]():e[Symbol.iterator]();return e3({start(){},async pull(e){let{done:s,value:n}=await t.next();s?e.close():e.enqueue(n)},async cancel(){await t.return?.()}})}function e6(e){if(e[Symbol.asyncIterator])return e;let t=e.getReader();return{async next(){try{let e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){let e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function e8(e){if(null===e||"object"!=typeof e)return;if(e[Symbol.asyncIterator])return void await e[Symbol.asyncIterator]().return?.();let t=e.getReader(),s=t.cancel();t.releaseLock(),await s}let e5=({headers:e,body:t})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(t)}),e9="RFC3986",e7=e=>String(e),te={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e7},tt=(e,t)=>(tt=Object.hasOwn??Function.prototype.call.bind(Object.prototype.hasOwnProperty))(e,t),ts=(()=>{let e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})();function tn(e,t){if(eG(e)){let s=[];for(let n=0;n<e.length;n+=1)s.push(t(e[n]));return s}return t(e)}let tr={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},ta=function(e,t){Array.prototype.push.apply(e,eG(t)?t:[t])},ti={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,n,r)=>{if(0===e.length)return e;let a=e;if("symbol"==typeof e?a=Symbol.prototype.toString.call(e):"string"!=typeof e&&(a=String(e)),"iso-8859-1"===s)return escape(a).replace(/%u[0-9a-f]{4}/gi,function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"});let i="";for(let e=0;e<a.length;e+=1024){let t=a.length>=1024?a.slice(e,e+1024):a,s=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);if(45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===r&&(40===n||41===n)){s[s.length]=t.charAt(e);continue}if(n<128){s[s.length]=ts[n];continue}if(n<2048){s[s.length]=ts[192|n>>6]+ts[128|63&n];continue}if(n<55296||n>=57344){s[s.length]=ts[224|n>>12]+ts[128|n>>6&63]+ts[128|63&n];continue}e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),s[s.length]=ts[240|n>>18]+ts[128|n>>12&63]+ts[128|n>>6&63]+ts[128|63&n]}i+=s.join("")}return i},encodeValuesOnly:!1,format:e9,formatter:e7,indices:!1,serializeDate:e=>(eA??(eA=Function.prototype.call.bind(Date.prototype.toISOString)))(e),skipNulls:!1,strictNullHandling:!1},to={};function tl(e){let t;return(e$??(e$=(t=new globalThis.TextEncoder).encode.bind(t)))(e)}function tc(e){let t;return(eI??(eI=(t=new globalThis.TextDecoder).decode.bind(t)))(e)}class th{constructor(){t.set(this,void 0),s.set(this,void 0),eO(this,t,new Uint8Array,"f"),eO(this,s,null,"f")}decode(e){let n;if(null==e)return[];let r=e instanceof ArrayBuffer?new Uint8Array(e):"string"==typeof e?tl(e):e;eO(this,t,function(e){let t=0;for(let s of e)t+=s.length;let s=new Uint8Array(t),n=0;for(let t of e)s.set(t,n),n+=t.length;return s}([eE(this,t,"f"),r]),"f");let a=[];for(;null!=(n=function(e,t){for(let s=t??0;s<e.length;s++){if(10===e[s])return{preceding:s,index:s+1,carriage:!1};if(13===e[s])return{preceding:s,index:s+1,carriage:!0}}return null}(eE(this,t,"f"),eE(this,s,"f")));){if(n.carriage&&null==eE(this,s,"f")){eO(this,s,n.index,"f");continue}if(null!=eE(this,s,"f")&&(n.index!==eE(this,s,"f")+1||n.carriage)){a.push(tc(eE(this,t,"f").subarray(0,eE(this,s,"f")-1))),eO(this,t,eE(this,t,"f").subarray(eE(this,s,"f")),"f"),eO(this,s,null,"f");continue}let e=null!==eE(this,s,"f")?n.preceding-1:n.preceding,r=tc(eE(this,t,"f").subarray(0,e));a.push(r),eO(this,t,eE(this,t,"f").subarray(n.index),"f"),eO(this,s,null,"f")}return a}flush(){return eE(this,t,"f").length?this.decode("\n"):[]}}t=new WeakMap,s=new WeakMap,th.NEWLINE_CHARS=new Set(["\n","\r"]),th.NEWLINE_REGEXP=/\r\n|[\n\r]/g;let tu={off:0,error:200,warn:300,info:400,debug:500},td=(e,t,s)=>{if(e){if(Object.prototype.hasOwnProperty.call(tu,e))return e;t_(s).warn(`${t} was set to ${JSON.stringify(e)}, expected one of ${JSON.stringify(Object.keys(tu))}`)}};function tf(){}function tp(e,t,s){return!t||tu[e]>tu[s]?tf:t[e].bind(t)}let tm={error:tf,warn:tf,info:tf,debug:tf},tg=new WeakMap;function t_(e){let t=e.logger,s=e.logLevel??"off";if(!t)return tm;let n=tg.get(t);if(n&&n[0]===s)return n[1];let r={error:tp("error",t,s),warn:tp("warn",t,s),info:tp("info",t,s),debug:tp("debug",t,s)};return tg.set(t,[s,r]),r}let ty=e=>(e.options&&(e.options={...e.options},delete e.options.headers),e.headers&&(e.headers=Object.fromEntries((e.headers instanceof Headers?[...e.headers]:Object.entries(e.headers)).map(([e,t])=>[e,"authorization"===e.toLowerCase()||"cookie"===e.toLowerCase()||"set-cookie"===e.toLowerCase()?"***":t]))),"retryOfRequestLogID"in e&&(e.retryOfRequestLogID&&(e.retryOf=e.retryOfRequestLogID),delete e.retryOfRequestLogID),e);class tw{constructor(e,t,s){this.iterator=e,n.set(this,void 0),this.controller=t,eO(this,n,s,"f")}static fromSSEResponse(e,t,s){let n=!1,r=s?t_(s):console;async function*a(){if(n)throw new eT("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let s=!1;try{for await(let n of tb(e,t))if(!s){if(n.data.startsWith("[DONE]")){s=!0;continue}if(null!==n.event&&n.event.startsWith("thread.")){let e;try{e=JSON.parse(n.data)}catch(e){throw console.error("Could not parse message into JSON:",n.data),console.error("From chunk:",n.raw),e}if("error"==n.event)throw new eC(void 0,e.error,e.message,void 0);yield{event:n.event,data:e}}else{let t;try{t=JSON.parse(n.data)}catch(e){throw r.error("Could not parse message into JSON:",n.data),r.error("From chunk:",n.raw),e}if(t&&t.error)throw new eC(void 0,t.error,void 0,e.headers);yield t}}s=!0}catch(e){if(ek(e))return;throw e}finally{s||t.abort()}}return new tw(a,t,s)}static fromReadableStream(e,t,s){let n=!1;async function*r(){let t=new th;for await(let s of e6(e))for(let e of t.decode(s))yield e;for(let e of t.flush())yield e}return new tw(async function*(){if(n)throw new eT("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let e=!1;try{for await(let t of r())!e&&t&&(yield JSON.parse(t));e=!0}catch(e){if(ek(e))return;throw e}finally{e||t.abort()}},t,s)}[(n=new WeakMap,Symbol.asyncIterator)](){return this.iterator()}tee(){let e=[],t=[],s=this.iterator(),r=n=>({next:()=>{if(0===n.length){let n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new tw(()=>r(e),this.controller,eE(this,n,"f")),new tw(()=>r(t),this.controller,eE(this,n,"f"))]}toReadableStream(){let e,t=this;return e3({async start(){e=t[Symbol.asyncIterator]()},async pull(t){try{let{value:s,done:n}=await e.next();if(n)return t.close();let r=tl(JSON.stringify(s)+"\n");t.enqueue(r)}catch(e){t.error(e)}},async cancel(){await e.return?.()}})}}async function*tb(e,t){if(!e.body){if(t.abort(),void 0!==globalThis.navigator&&"ReactNative"===globalThis.navigator.product)throw new eT("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api");throw new eT("Attempted to iterate over a response with no body")}let s=new tS,n=new th;for await(let t of tv(e6(e.body)))for(let e of n.decode(t)){let t=s.decode(e);t&&(yield t)}for(let e of n.flush()){let t=s.decode(e);t&&(yield t)}}async function*tv(e){let t=new Uint8Array;for await(let s of e){let e;if(null==s)continue;let n=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?tl(s):s,r=new Uint8Array(t.length+n.length);for(r.set(t),r.set(n,t.length),t=r;-1!==(e=function(e){for(let t=0;t<e.length-1;t++){if(10===e[t]&&10===e[t+1]||13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return -1}(t));)yield t.slice(0,e),t=t.slice(e)}t.length>0&&(yield t)}class tS{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){var t;let s;if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;let e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[n,r,a]=-1!==(s=(t=e).indexOf(":"))?[t.substring(0,s),":",t.substring(s+1)]:[t,"",""];return a.startsWith(" ")&&(a=a.substring(1)),"event"===n?this.event=a:"data"===n&&this.data.push(a),null}}async function tx(e,t){let{response:s,requestLogID:n,retryOfRequestLogID:r,startTime:a}=t,i=await (async()=>{if(t.options.stream)return(t_(e).debug("response",s.status,s.url,s.headers,s.body),t.options.__streamClass)?t.options.__streamClass.fromSSEResponse(s,t.controller,e):tw.fromSSEResponse(s,t.controller,e);if(204===s.status)return null;if(t.options.__binaryResponse)return s;let n=s.headers.get("content-type"),r=n?.split(";")[0]?.trim();if(r?.includes("application/json")||r?.endsWith("+json")){if("0"===s.headers.get("content-length"))return;return tA(await s.json(),s)}return await s.text()})();return t_(e).debug(`[${n}] response parsed`,ty({retryOfRequestLogID:r,url:s.url,status:s.status,body:i,durationMs:Date.now()-a})),i}function tA(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class t$ extends Promise{constructor(e,t,s=tx){super(e=>{e(null)}),this.responsePromise=t,this.parseResponse=s,r.set(this,void 0),eO(this,r,e,"f")}_thenUnwrap(e){return new t$(eE(this,r,"f"),this.responsePromise,async(t,s)=>tA(e(await this.parseResponse(t,s),s),s.response))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){let[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(eE(this,r,"f"),e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}r=new WeakMap;class tI{constructor(e,t,s,n){a.set(this,void 0),eO(this,a,e,"f"),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageRequestOptions()}async getNextPage(){let e=this.nextPageRequestOptions();if(!e)throw new eT("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");return await eE(this,a,"f").requestAPIList(this.constructor,e)}async *iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async *[(a=new WeakMap,Symbol.asyncIterator)](){for await(let e of this.iterPages())for(let t of e.getPaginatedItems())yield t}}class tO extends t${constructor(e,t,s){super(e,t,async(e,t)=>new s(e,t.response,await tx(e,t),t.options))}async *[Symbol.asyncIterator](){for await(let e of(await this))yield e}}class tE extends tI{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageRequestOptions(){return null}}class tR extends tI{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.getPaginatedItems(),t=e[e.length-1]?.id;return t?{...this.options,query:{...eY(this.options.query),after:t}}:null}}class tk extends tI{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.has_more=s.has_more||!1,this.last_id=s.last_id||""}getPaginatedItems(){return this.data??[]}hasNextPage(){return!1!==this.has_more&&super.hasNextPage()}nextPageRequestOptions(){let e=this.last_id;return e?{...this.options,query:{...eY(this.options.query),after:e}}:null}}let tP=()=>{if("u"<typeof File){let{process:e}=globalThis;throw Error("`File` is not defined as a global, which is required for file uploads."+("string"==typeof e?.versions?.node&&20>parseInt(e.versions.node.split("."))?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function tT(e,t,s){return tP(),new File(e,t??"unknown_file",s)}function tC(e){return("object"==typeof e&&null!==e&&("name"in e&&e.name&&String(e.name)||"url"in e&&e.url&&String(e.url)||"filename"in e&&e.filename&&String(e.filename)||"path"in e&&e.path&&String(e.path))||"").split(/[\\/]/).pop()||void 0}let tN=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],tM=async(e,t)=>tW(e.body)?{...e,body:await tD(e.body,t)}:e,tj=async(e,t)=>({...e,body:await tD(e.body,t)}),tL=new WeakMap,tD=async(e,t)=>{if(!await function(e){let t="function"==typeof e?e:e.fetch,s=tL.get(t);if(s)return s;let n=(async()=>{try{let e="Response"in t?t.Response:(await t("data:,")).constructor,s=new FormData;if(s.toString()===await new e(s).text())return!1;return!0}catch{return!0}})();return tL.set(t,n),n}(t))throw TypeError("The provided fetch function does not support file uploads with the current global FormData class.");let s=new FormData;return await Promise.all(Object.entries(e||{}).map(([e,t])=>tF(s,e,t))),s},tB=e=>e instanceof Blob&&"name"in e,tW=e=>{if("object"==typeof e&&null!==e&&(e instanceof Response||tN(e)||tB(e)))return!0;if(Array.isArray(e))return e.some(tW);if(e&&"object"==typeof e){for(let t in e)if(tW(e[t]))return!0}return!1},tF=async(e,t,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if(s instanceof Response)e.append(t,tT([await s.blob()],tC(s)));else if(tN(s))e.append(t,tT([await new Response(e4(s)).blob()],tC(s)));else if(tB(s))e.append(t,s,tC(s));else if(Array.isArray(s))await Promise.all(s.map(s=>tF(e,t+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,n])=>tF(e,`${t}[${s}]`,n)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}},tU=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function tq(e,t,s){let n,r;if(tP(),null!=(n=e=await e)&&"object"==typeof n&&"string"==typeof n.name&&"number"==typeof n.lastModified&&tU(n))return e instanceof File?e:tT([await e.arrayBuffer()],e.name);if(null!=(r=e)&&"object"==typeof r&&"string"==typeof r.url&&"function"==typeof r.blob){let n=await e.blob();return t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()),tT(await tX(n),t,s)}let a=await tX(e);if(t||(t=tC(e)),!s?.type){let e=a.find(e=>"object"==typeof e&&"type"in e&&e.type);"string"==typeof e&&(s={...s,type:e})}return tT(a,t,s)}async function tX(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(tU(e))t.push(e instanceof Blob?e:await e.arrayBuffer());else if(tN(e))for await(let s of e)t.push(...await tX(s));else{let t=e?.constructor?.name;throw Error(`Unexpected data type: ${typeof e}${t?`; constructor: ${t}`:""}${function(e){if("object"!=typeof e||null===e)return"";let t=Object.getOwnPropertyNames(e);return`; props: [${t.map(e=>`"${e}"`).join(", ")}]`}(e)}`)}return t}class tH{constructor(e){this._client=e}}function tJ(e){return e.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}let tK=Object.freeze(Object.create(null)),tV=((e=tJ)=>function(t,...s){let n;if(1===t.length)return t[0];let r=!1,a=[],i=t.reduce((t,n,i)=>{/[?#]/.test(n)&&(r=!0);let o=s[i],l=(r?encodeURIComponent:e)(""+o);return i!==s.length&&(null==o||"object"==typeof o&&o.toString===Object.getPrototypeOf(Object.getPrototypeOf(o.hasOwnProperty??tK)??tK)?.toString)&&(l=o+"",a.push({start:t.length+n.length,length:l.length,error:`Value of type ${Object.prototype.toString.call(o).slice(8,-1)} is not a valid path parameter`})),t+n+(i===s.length?"":l)},""),o=i.split(/[?#]/,1)[0],l=/(?<=^|\/)(?:\.|%2e){1,2}(?=\/|$)/gi;for(;null!==(n=l.exec(o));)a.push({start:n.index,length:n[0].length,error:`Value "${n[0]}" can't be safely passed as a path parameter`});if(a.sort((e,t)=>e.start-t.start),a.length>0){let e=0,t=a.reduce((t,s)=>{let n=" ".repeat(s.start-e),r="^".repeat(s.length);return e=s.start+s.length,t+n+r},"");throw new eT(`Path parameters result in path with invalid segments:
${a.map(e=>e.error).join("\n")}
${i}
${t}`)}return i})(tJ);class tG extends tH{list(e,t={},s){return this._client.getAPIList(tV`/chat/completions/${e}/messages`,tR,{query:t,...s})}}function tz(e){return void 0!==e&&"function"in e&&void 0!==e.function}function tY(e){return e?.$brand==="auto-parseable-response-format"}function tQ(e){return e?.$brand==="auto-parseable-tool"}function tZ(e,t){let s=e.choices.map(e=>{var s,n;if("length"===e.finish_reason)throw new eH;if("content_filter"===e.finish_reason)throw new eJ;return t1(e.message.tool_calls),{...e,message:{...e.message,...e.message.tool_calls?{tool_calls:e.message.tool_calls?.map(e=>{var s,n;let r;return s=t,n=e,r=s.tools?.find(e=>tz(e)&&e.function?.name===n.function.name),{...n,function:{...n.function,parsed_arguments:tQ(r)?r.$parseRaw(n.function.arguments):r?.function.strict?JSON.parse(n.function.arguments):null}}})??void 0}:void 0,parsed:e.message.content&&!e.message.refusal?(s=t,n=e.message.content,s.response_format?.type!=="json_schema"?null:s.response_format?.type==="json_schema"?"$parseRaw"in s.response_format?s.response_format.$parseRaw(n):JSON.parse(n):null):null}}});return{...e,choices:s}}function t0(e){return!!tY(e.response_format)||(e.tools?.some(e=>tQ(e)||"function"===e.type&&!0===e.function.strict)??!1)}function t1(e){for(let t of e||[])if("function"!==t.type)throw new eT(`Currently only \`function\` tool calls are supported; Received \`${t.type}\``)}let t2=e=>e?.role==="assistant",t3=e=>e?.role==="tool";class t4{constructor(){i.add(this),this.controller=new AbortController,o.set(this,void 0),l.set(this,()=>{}),c.set(this,()=>{}),h.set(this,void 0),u.set(this,()=>{}),d.set(this,()=>{}),f.set(this,{}),p.set(this,!1),m.set(this,!1),g.set(this,!1),_.set(this,!1),eO(this,o,new Promise((e,t)=>{eO(this,l,e,"f"),eO(this,c,t,"f")}),"f"),eO(this,h,new Promise((e,t)=>{eO(this,u,e,"f"),eO(this,d,t,"f")}),"f"),eE(this,o,"f").catch(()=>{}),eE(this,h,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},eE(this,i,"m",y).bind(this))},0)}_connected(){this.ended||(eE(this,l,"f").call(this),this._emit("connect"))}get ended(){return eE(this,p,"f")}get errored(){return eE(this,m,"f")}get aborted(){return eE(this,g,"f")}abort(){this.controller.abort()}on(e,t){return(eE(this,f,"f")[e]||(eE(this,f,"f")[e]=[])).push({listener:t}),this}off(e,t){let s=eE(this,f,"f")[e];if(!s)return this;let n=s.findIndex(e=>e.listener===t);return n>=0&&s.splice(n,1),this}once(e,t){return(eE(this,f,"f")[e]||(eE(this,f,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,s)=>{eO(this,_,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)})}async done(){eO(this,_,!0,"f"),await eE(this,h,"f")}_emit(e,...t){if(eE(this,p,"f"))return;"end"===e&&(eO(this,p,!0,"f"),eE(this,u,"f").call(this));let s=eE(this,f,"f")[e];if(s&&(eE(this,f,"f")[e]=s.filter(e=>!e.once),s.forEach(({listener:e})=>e(...t))),"abort"===e){let e=t[0];eE(this,_,"f")||s?.length||Promise.reject(e),eE(this,c,"f").call(this,e),eE(this,d,"f").call(this,e),this._emit("end");return}if("error"===e){let e=t[0];eE(this,_,"f")||s?.length||Promise.reject(e),eE(this,c,"f").call(this,e),eE(this,d,"f").call(this,e),this._emit("end")}}_emitFinal(){}}o=new WeakMap,l=new WeakMap,c=new WeakMap,h=new WeakMap,u=new WeakMap,d=new WeakMap,f=new WeakMap,p=new WeakMap,m=new WeakMap,g=new WeakMap,_=new WeakMap,i=new WeakSet,y=function(e){if(eO(this,m,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new eN),e instanceof eN)return eO(this,g,!0,"f"),this._emit("abort",e);if(e instanceof eT)return this._emit("error",e);if(e instanceof Error){let t=new eT(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new eT(String(e)))};class t6 extends t4{constructor(){super(...arguments),w.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);let t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t){if(this._emit("message",e),t3(e)&&e.content)this._emit("functionToolCallResult",e.content);else if(t2(e)&&e.tool_calls)for(let t of e.tool_calls)"function"===t.type&&this._emit("functionToolCall",t.function)}}async finalChatCompletion(){await this.done();let e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new eT("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),eE(this,w,"m",b).call(this)}async finalMessage(){return await this.done(),eE(this,w,"m",v).call(this)}async finalFunctionToolCall(){return await this.done(),eE(this,w,"m",S).call(this)}async finalFunctionToolCallResult(){return await this.done(),eE(this,w,"m",x).call(this)}async totalUsage(){return await this.done(),eE(this,w,"m",A).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){let e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);let t=eE(this,w,"m",v).call(this);t&&this._emit("finalMessage",t);let s=eE(this,w,"m",b).call(this);s&&this._emit("finalContent",s);let n=eE(this,w,"m",S).call(this);n&&this._emit("finalFunctionToolCall",n);let r=eE(this,w,"m",x).call(this);null!=r&&this._emit("finalFunctionToolCallResult",r),this._chatCompletions.some(e=>e.usage)&&this._emit("totalUsage",eE(this,w,"m",A).call(this))}async _createChatCompletion(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eE(this,w,"m",$).call(this,t);let r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(tZ(r,t))}async _runChatCompletion(e,t,s){for(let e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runTools(e,t,s){let n="tool",{tool_choice:r="auto",stream:a,...i}=t,o="string"!=typeof r&&"function"===r.type&&r?.function?.name,{maxChatCompletions:l=10}=s||{},c=t.tools.map(e=>{if(tQ(e)){if(!e.$callback)throw new eT("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e}),h={};for(let e of c)"function"===e.type&&(h[e.function.name||e.function.function.name]=e.function);let u="tools"in t?c.map(e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e):void 0;for(let e of t.messages)this._addMessage(e,!1);for(let t=0;t<l;++t){let t=await this._createChatCompletion(e,{...i,tool_choice:r,tools:u,messages:[...this.messages]},s),a=t.choices[0]?.message;if(!a)throw new eT("missing message in ChatCompletion response");if(!a.tool_calls?.length)break;for(let e of a.tool_calls){let t;if("function"!==e.type)continue;let s=e.id,{name:r,arguments:a}=e.function,i=h[r];if(i){if(o&&o!==r){let e=`Invalid tool_call: ${JSON.stringify(r)}. ${JSON.stringify(o)} requested. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}}else{let e=`Invalid tool_call: ${JSON.stringify(r)}. Available options are: ${Object.keys(h).map(e=>JSON.stringify(e)).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:s,content:e});continue}try{t="function"==typeof i.parse?await i.parse(a):a}catch(t){let e=t instanceof Error?t.message:String(t);this._addMessage({role:n,tool_call_id:s,content:e});continue}let l=await i.function(t,this),c=eE(this,w,"m",I).call(this,l);if(this._addMessage({role:n,tool_call_id:s,content:c}),o)return}}}}w=new WeakSet,b=function(){return eE(this,w,"m",v).call(this).content??null},v=function(){let e=this.messages.length;for(;e-- >0;){let t=this.messages[e];if(t2(t))return{...t,content:t.content??null,refusal:t.refusal??null}}throw new eT("stream ended without producing a ChatCompletionMessage with role=assistant")},S=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(t2(t)&&t?.tool_calls?.length)return t.tool_calls.filter(e=>"function"===e.type).at(-1)?.function}},x=function(){for(let e=this.messages.length-1;e>=0;e--){let t=this.messages[e];if(t3(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some(e=>"assistant"===e.role&&e.tool_calls?.some(e=>"function"===e.type&&e.id===t.tool_call_id)))return t.content}},A=function(){let e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},$=function(e){if(null!=e.n&&e.n>1)throw new eT("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},I=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class t8 extends t6{static runTools(e,t,s){let n=new t8,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}_addMessage(e,t=!0){super._addMessage(e,t),t2(e)&&e.content&&this._emit("content",e.content)}}let t5=511;class t9 extends Error{}class t7 extends Error{}let se=e=>(function(e,t=t5){var s,n;let r,a,i,o,l,c,h,u,d,f;if("string"!=typeof e)throw TypeError(`expecting str, got ${typeof e}`);if(!e.trim())throw Error(`${e} is empty`);return s=e.trim(),n=t,r=s.length,a=0,i=e=>{throw new t9(`${e} at position ${a}`)},o=e=>{throw new t7(`${e} at position ${a}`)},l=()=>(f(),a>=r&&i("Unexpected end of input"),'"'===s[a])?c():"{"===s[a]?h():"["===s[a]?u():"null"===s.substring(a,a+4)||16&n&&r-a<4&&"null".startsWith(s.substring(a))?(a+=4,null):"true"===s.substring(a,a+4)||32&n&&r-a<4&&"true".startsWith(s.substring(a))?(a+=4,!0):"false"===s.substring(a,a+5)||32&n&&r-a<5&&"false".startsWith(s.substring(a))?(a+=5,!1):"Infinity"===s.substring(a,a+8)||128&n&&r-a<8&&"Infinity".startsWith(s.substring(a))?(a+=8,1/0):"-Infinity"===s.substring(a,a+9)||256&n&&1<r-a&&r-a<9&&"-Infinity".startsWith(s.substring(a))?(a+=9,-1/0):"NaN"===s.substring(a,a+3)||64&n&&r-a<3&&"NaN".startsWith(s.substring(a))?(a+=3,NaN):d(),c=()=>{let e=a,t=!1;for(a++;a<r&&('"'!==s[a]||t&&"\\"===s[a-1]);)t="\\"===s[a]&&!t,a++;if('"'==s.charAt(a))try{return JSON.parse(s.substring(e,++a-Number(t)))}catch(e){o(String(e))}else if(1&n)try{return JSON.parse(s.substring(e,a-Number(t))+'"')}catch(t){return JSON.parse(s.substring(e,s.lastIndexOf("\\"))+'"')}i("Unterminated string literal")},h=()=>{a++,f();let e={};try{for(;"}"!==s[a];){if(f(),a>=r&&8&n)return e;let t=c();f(),a++;try{let s=l();Object.defineProperty(e,t,{value:s,writable:!0,enumerable:!0,configurable:!0})}catch(t){if(8&n)return e;throw t}f(),","===s[a]&&a++}}catch(t){if(8&n)return e;i("Expected '}' at end of object")}return a++,e},u=()=>{a++;let e=[];try{for(;"]"!==s[a];)e.push(l()),f(),","===s[a]&&a++}catch(t){if(4&n)return e;i("Expected ']' at end of array")}return a++,e},d=()=>{if(0===a){"-"===s&&2&n&&i("Not sure what '-' is");try{return JSON.parse(s)}catch(e){if(2&n)try{if("."===s[s.length-1])return JSON.parse(s.substring(0,s.lastIndexOf(".")));return JSON.parse(s.substring(0,s.lastIndexOf("e")))}catch(e){}o(String(e))}}let e=a;for("-"===s[a]&&a++;s[a]&&!",]}".includes(s[a]);)a++;a!=r||2&n||i("Unterminated number literal");try{return JSON.parse(s.substring(e,a))}catch(t){"-"===s.substring(e,a)&&2&n&&i("Not sure what '-' is");try{return JSON.parse(s.substring(e,s.lastIndexOf("e")))}catch(e){o(String(e))}}},f=()=>{for(;a<r&&" \n\r	".includes(s[a]);)a++},l()})(e,2^t5);class st extends t6{constructor(e){super(),O.add(this),E.set(this,void 0),R.set(this,void 0),k.set(this,void 0),eO(this,E,e,"f"),eO(this,R,[],"f")}get currentChatCompletionSnapshot(){return eE(this,k,"f")}static fromReadableStream(e){let t=new st(null);return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,s){let n=new st(t);return n._run(()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createChatCompletion(e,t,s){super._createChatCompletion;let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eE(this,O,"m",P).call(this);let r=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});for await(let e of(this._connected(),r))eE(this,O,"m",C).call(this,e);if(r.controller.signal?.aborted)throw new eN;return this._addChatCompletion(eE(this,O,"m",j).call(this))}async _fromReadableStream(e,t){let s,n=t?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort())),eE(this,O,"m",P).call(this),this._connected();let r=tw.fromReadableStream(e,this.controller);for await(let e of r)s&&s!==e.id&&this._addChatCompletion(eE(this,O,"m",j).call(this)),eE(this,O,"m",C).call(this,e),s=e.id;if(r.controller.signal?.aborted)throw new eN;return this._addChatCompletion(eE(this,O,"m",j).call(this))}[(E=new WeakMap,R=new WeakMap,k=new WeakMap,O=new WeakSet,P=function(){this.ended||eO(this,k,void 0,"f")},T=function(e){let t=eE(this,R,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},eE(this,R,"f")[e.index]=t),t},C=function(e){if(this.ended)return;let t=eE(this,O,"m",D).call(this,e);for(let s of(this._emit("chunk",e,t),e.choices)){let e=t.choices[s.index];null!=s.delta.content&&e.message?.role==="assistant"&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&e.message?.role==="assistant"&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),s.logprobs?.content!=null&&e.message?.role==="assistant"&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),s.logprobs?.refusal!=null&&e.message?.role==="assistant"&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});let n=eE(this,O,"m",T).call(this,e);for(let t of(e.finish_reason&&(eE(this,O,"m",M).call(this,e),null!=n.current_tool_call_index&&eE(this,O,"m",N).call(this,e,n.current_tool_call_index)),s.delta.tool_calls??[]))n.current_tool_call_index!==t.index&&(eE(this,O,"m",M).call(this,e),null!=n.current_tool_call_index&&eE(this,O,"m",N).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(let t of s.delta.tool_calls??[]){let s=e.message.tool_calls?.[t.index];s?.type&&(s?.type==="function"?this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""}):sr(s?.type))}}},N=function(e,t){if(eE(this,O,"m",T).call(this,e).done_tool_calls.has(t))return;let s=e.message.tool_calls?.[t];if(!s)throw Error("no tool call snapshot");if(!s.type)throw Error("tool call snapshot missing `type`");if("function"===s.type){let e=eE(this,E,"f")?.tools?.find(e=>tz(e)&&e.function.name===s.function.name);this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:tQ(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else sr(s.type)},M=function(e){let t=eE(this,O,"m",T).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;let s=eE(this,O,"m",L).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},j=function(){if(this.ended)throw new eT("stream has ended, this shouldn't happen");let e=eE(this,k,"f");if(!e)throw new eT("request ended without sending any chunks");return eO(this,k,void 0,"f"),eO(this,R,[],"f"),function(e,t){var s;let{id:n,choices:r,created:a,model:i,system_fingerprint:o,...l}=e;return s={...l,id:n,choices:r.map(({message:t,finish_reason:s,index:n,logprobs:r,...a})=>{if(!s)throw new eT(`missing finish_reason for choice ${n}`);let{content:i=null,function_call:o,tool_calls:l,...c}=t,h=t.role;if(!h)throw new eT(`missing role for choice ${n}`);if(o){let{arguments:e,name:l}=o;if(null==e)throw new eT(`missing function_call.arguments for choice ${n}`);if(!l)throw new eT(`missing function_call.name for choice ${n}`);return{...a,message:{content:i,function_call:{arguments:e,name:l},role:h,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}return l?{...a,index:n,finish_reason:s,logprobs:r,message:{...c,role:h,content:i,refusal:t.refusal??null,tool_calls:l.map((t,s)=>{let{function:r,type:a,id:i,...o}=t,{arguments:l,name:c,...h}=r||{};if(null==i)throw new eT(`missing choices[${n}].tool_calls[${s}].id
${ss(e)}`);if(null==a)throw new eT(`missing choices[${n}].tool_calls[${s}].type
${ss(e)}`);if(null==c)throw new eT(`missing choices[${n}].tool_calls[${s}].function.name
${ss(e)}`);if(null==l)throw new eT(`missing choices[${n}].tool_calls[${s}].function.arguments
${ss(e)}`);return{...o,id:i,type:a,function:{...h,name:c,arguments:l}}})}}:{...a,message:{...c,content:i,role:h,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}),created:a,model:i,object:"chat.completion",...o?{system_fingerprint:o}:{}},t&&t0(t)?tZ(s,t):{...s,choices:s.choices.map(e=>(t1(e.message.tool_calls),{...e,message:{...e.message,parsed:null,...e.message.tool_calls?{tool_calls:e.message.tool_calls}:void 0}}))}}(e,eE(this,E,"f"))},L=function(){let e=eE(this,E,"f")?.response_format;return tY(e)?e:null},D=function(e){var t,s,n,r;let a=eE(this,k,"f"),{choices:i,...o}=e;for(let{delta:i,finish_reason:l,index:c,logprobs:h=null,...u}of(a?Object.assign(a,o):a=eO(this,k,{...o,choices:[]},"f"),e.choices)){let e=a.choices[c];if(e||(e=a.choices[c]={finish_reason:l,index:c,message:{},logprobs:h,...u}),h)if(e.logprobs){let{content:n,refusal:r,...a}=h;sn(a),Object.assign(e.logprobs,a),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),r&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},h);if(l&&(e.finish_reason=l,eE(this,E,"f")&&t0(eE(this,E,"f")))){if("length"===l)throw new eH;if("content_filter"===l)throw new eJ}if(Object.assign(e,u),!i)continue;let{content:o,refusal:d,function_call:f,role:p,tool_calls:m,...g}=i;if(sn(g),Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),p&&(e.message.role=p),f&&(e.message.function_call?(f.name&&(e.message.function_call.name=f.name),f.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=f.arguments)):e.message.function_call=f),o&&(e.message.content=(e.message.content||"")+o,!e.message.refusal&&eE(this,O,"m",L).call(this)&&(e.message.parsed=se(e.message.content))),m)for(let{index:t,id:s,type:n,function:a,...i}of(e.message.tool_calls||(e.message.tool_calls=[]),m)){let o=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(o,i),s&&(o.id=s),n&&(o.type=n),a&&(o.function??(o.function={name:a.name??"",arguments:""})),a?.name&&(o.function.name=a.name),a?.arguments&&(o.function.arguments+=a.arguments,function(e,t){if(!e||!("tools"in e)||!e.tools)return!1;let s=e.tools?.find(e=>tz(e)&&e.function?.name===t.function.name);return tz(s)&&(tQ(s)||s?.function.strict||!1)}(eE(this,E,"f"),o)&&(o.function.parsed_arguments=se(o.function.arguments)))}}return a},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("chunk",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new tw(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function ss(e){return JSON.stringify(e)}function sn(e){}function sr(e){}class sa extends st{static fromReadableStream(e){let t=new sa(null);return t._run(()=>t._fromReadableStream(e)),t}static runTools(e,t,s){let n=new sa(t),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run(()=>n._runTools(e,t,r)),n}}class si extends tH{constructor(){super(...arguments),this.messages=new tG(this._client)}create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}retrieve(e,t){return this._client.get(tV`/chat/completions/${e}`,t)}update(e,t,s){return this._client.post(tV`/chat/completions/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/chat/completions",tR,{query:e,...t})}delete(e,t){return this._client.delete(tV`/chat/completions/${e}`,t)}parse(e,t){for(let t of e.tools??[]){if("function"!==t.type)throw new eT(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new eT(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}return this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"chat.completions.parse"}})._thenUnwrap(t=>tZ(t,e))}runTools(e,t){return e.stream?sa.runTools(this._client,e,t):t8.runTools(this._client,e,t)}stream(e,t){return st.createChatCompletion(this._client,e,t)}}si.Messages=tG;class so extends tH{constructor(){super(...arguments),this.completions=new si(this._client)}}so.Completions=si,e.s([],16960);let sl=Symbol("brand.privateNullableHeaders"),sc=e=>{let t=new Headers,s=new Set;for(let n of e){let e=new Set;for(let[r,a]of function*(e){let t;if(!e)return;if(sl in e){let{values:t,nulls:s}=e;for(let e of(yield*t.entries(),s))yield[e,null];return}let s=!1;for(let n of(e instanceof Headers?t=e.entries():ez(e)?t=e:(s=!0,t=Object.entries(e??{})),t)){let e=n[0];if("string"!=typeof e)throw TypeError("expected header name to be a string");let t=ez(n[1])?n[1]:[n[1]],r=!1;for(let n of t)void 0!==n&&(s&&!r&&(r=!0,yield[e,null]),yield[e,n])}}(n)){let n=r.toLowerCase();e.has(n)||(t.delete(r),e.add(n)),null===a?(t.delete(r),s.add(n)):(t.append(r,a),s.delete(n))}}return{[sl]:!0,values:t,nulls:s}};class sh extends tH{create(e,t){return this._client.post("/audio/speech",{body:e,...t,headers:sc([{Accept:"application/octet-stream"},t?.headers]),__binaryResponse:!0})}}class su extends tH{create(e,t){return this._client.post("/audio/transcriptions",tj({body:e,...t,stream:e.stream??!1,__metadata:{model:e.model}},this._client))}}class sd extends tH{create(e,t){return this._client.post("/audio/translations",tj({body:e,...t,__metadata:{model:e.model}},this._client))}}class sf extends tH{constructor(){super(...arguments),this.transcriptions=new su(this._client),this.translations=new sd(this._client),this.speech=new sh(this._client)}}sf.Transcriptions=su,sf.Translations=sd,sf.Speech=sh;class sp extends tH{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(tV`/batches/${e}`,t)}list(e={},t){return this._client.getAPIList("/batches",tR,{query:e,...t})}cancel(e,t){return this._client.post(tV`/batches/${e}/cancel`,t)}}class sm extends tH{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:sc([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(tV`/assistants/${e}`,{...t,headers:sc([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(tV`/assistants/${e}`,{body:t,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/assistants",tR,{query:e,...t,headers:sc([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(tV`/assistants/${e}`,{...t,headers:sc([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sg extends tH{create(e,t){return this._client.post("/realtime/sessions",{body:e,...t,headers:sc([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class s_ extends tH{create(e,t){return this._client.post("/realtime/transcription_sessions",{body:e,...t,headers:sc([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}}class sy extends tH{constructor(){super(...arguments),this.sessions=new sg(this._client),this.transcriptionSessions=new s_(this._client)}}sy.Sessions=sg,sy.TranscriptionSessions=s_;class sw extends tH{create(e,t){return this._client.post("/chatkit/sessions",{body:e,...t,headers:sc([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}cancel(e,t){return this._client.post(tV`/chatkit/sessions/${e}/cancel`,{...t,headers:sc([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}}class sb extends tH{retrieve(e,t){return this._client.get(tV`/chatkit/threads/${e}`,{...t,headers:sc([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}list(e={},t){return this._client.getAPIList("/chatkit/threads",tk,{query:e,...t,headers:sc([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}delete(e,t){return this._client.delete(tV`/chatkit/threads/${e}`,{...t,headers:sc([{"OpenAI-Beta":"chatkit_beta=v1"},t?.headers])})}listItems(e,t={},s){return this._client.getAPIList(tV`/chatkit/threads/${e}/items`,tk,{query:t,...s,headers:sc([{"OpenAI-Beta":"chatkit_beta=v1"},s?.headers])})}}class sv extends tH{constructor(){super(...arguments),this.sessions=new sw(this._client),this.threads=new sb(this._client)}}sv.Sessions=sw,sv.Threads=sb;class sS extends tH{create(e,t,s){return this._client.post(tV`/threads/${e}/messages`,{body:t,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(tV`/threads/${n}/messages/${e}`,{...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(tV`/threads/${n}/messages/${e}`,{body:r,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(tV`/threads/${e}/messages`,tR,{query:t,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{thread_id:n}=t;return this._client.delete(tV`/threads/${n}/messages/${e}`,{...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class sx extends tH{retrieve(e,t,s){let{thread_id:n,run_id:r,...a}=t;return this._client.get(tV`/threads/${n}/runs/${r}/steps/${e}`,{query:a,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t,s){let{thread_id:n,...r}=t;return this._client.getAPIList(tV`/threads/${n}/runs/${e}/steps`,tR,{query:r,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}let sA=e=>void 0!==globalThis.process?globalThis.process.env?.[e]?.trim()??void 0:void 0!==globalThis.Deno?globalThis.Deno.env?.get?.(e)?.trim():void 0;class s$ extends t4{constructor(){super(...arguments),B.add(this),F.set(this,[]),U.set(this,{}),q.set(this,{}),X.set(this,void 0),H.set(this,void 0),J.set(this,void 0),K.set(this,void 0),V.set(this,void 0),G.set(this,void 0),z.set(this,void 0),Y.set(this,void 0),Q.set(this,void 0)}[(F=new WeakMap,U=new WeakMap,q=new WeakMap,X=new WeakMap,H=new WeakMap,J=new WeakMap,K=new WeakMap,V=new WeakMap,G=new WeakMap,z=new WeakMap,Y=new WeakMap,Q=new WeakMap,B=new WeakSet,Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){let t=new W;return t._run(()=>t._fromReadableStream(e)),t}async _fromReadableStream(e,t){let s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let n=tw.fromReadableStream(e,this.controller);for await(let e of n)eE(this,B,"m",Z).call(this,e);if(n.controller.signal?.aborted)throw new eN;return this._addRun(eE(this,B,"m",ee).call(this))}toReadableStream(){return new tw(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n){let r=new W;return r._run(()=>r._runToolAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}async _createToolAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let a={...s,stream:!0},i=await e.submitToolOutputs(t,a,{...n,signal:this.controller.signal});for await(let e of(this._connected(),i))eE(this,B,"m",Z).call(this,e);if(i.controller.signal?.aborted)throw new eN;return this._addRun(eE(this,B,"m",ee).call(this))}static createThreadAssistantStream(e,t,s){let n=new W;return n._run(()=>n._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}static createAssistantStream(e,t,s,n){let r=new W;return r._run(()=>r._runAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),r}currentEvent(){return eE(this,z,"f")}currentRun(){return eE(this,Y,"f")}currentMessageSnapshot(){return eE(this,X,"f")}currentRunStepSnapshot(){return eE(this,Q,"f")}async finalRunSteps(){return await this.done(),Object.values(eE(this,U,"f"))}async finalMessages(){return await this.done(),Object.values(eE(this,q,"f"))}async finalRun(){if(await this.done(),!eE(this,H,"f"))throw Error("Final run was not received.");return eE(this,H,"f")}async _createThreadAssistantStream(e,t,s){let n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",()=>this.controller.abort()));let r={...t,stream:!0},a=await e.createAndRun(r,{...s,signal:this.controller.signal});for await(let e of(this._connected(),a))eE(this,B,"m",Z).call(this,e);if(a.controller.signal?.aborted)throw new eN;return this._addRun(eE(this,B,"m",ee).call(this))}async _createAssistantStream(e,t,s,n){let r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort()));let a={...s,stream:!0},i=await e.create(t,a,{...n,signal:this.controller.signal});for await(let e of(this._connected(),i))eE(this,B,"m",Z).call(this,e);if(i.controller.signal?.aborted)throw new eN;return this._addRun(eE(this,B,"m",ee).call(this))}static accumulateDelta(e,t){for(let[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let t=e[s];if(null==t||"index"===s||"type"===s){e[s]=n;continue}if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else if(eQ(t)&&eQ(n))t=this.accumulateDelta(t,n);else if(Array.isArray(t)&&Array.isArray(n)){if(t.every(e=>"string"==typeof e||"number"==typeof e)){t.push(...n);continue}for(let e of n){if(!eQ(e))throw Error(`Expected array delta entry to be an object but got: ${e}`);let s=e.index;if(null==s)throw console.error(e),Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);let n=t[s];null==n?t.push(e):t[s]=this.accumulateDelta(n,e)}continue}else throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${t}`);e[s]=t}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n){return await this._createToolAssistantStream(t,e,s,n)}}W=s$,Z=function(e){if(!this.ended)switch(eO(this,z,e,"f"),eE(this,B,"m",en).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.incomplete":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":eE(this,B,"m",eo).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eE(this,B,"m",es).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":eE(this,B,"m",et).call(this,e);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},ee=function(){if(this.ended)throw new eT("stream has ended, this shouldn't happen");if(!eE(this,H,"f"))throw Error("Final run has not been received");return eE(this,H,"f")},et=function(e){let[t,s]=eE(this,B,"m",ea).call(this,e,eE(this,X,"f"));for(let e of(eO(this,X,t,"f"),eE(this,q,"f")[t.id]=t,s)){let s=t.content[e.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(let s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,n=t.content[s.index];if(n&&"text"==n.type)this._emit("textDelta",e,n.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=eE(this,J,"f")){if(eE(this,K,"f"))switch(eE(this,K,"f").type){case"text":this._emit("textDone",eE(this,K,"f").text,eE(this,X,"f"));break;case"image_file":this._emit("imageFileDone",eE(this,K,"f").image_file,eE(this,X,"f"))}eO(this,J,s.index,"f")}eO(this,K,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==eE(this,J,"f")){let t=e.data.content[eE(this,J,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,eE(this,X,"f"));break;case"text":this._emit("textDone",t.text,eE(this,X,"f"))}}eE(this,X,"f")&&this._emit("messageDone",e.data),eO(this,X,void 0,"f")}},es=function(e){let t=eE(this,B,"m",er).call(this,e);switch(eO(this,Q,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":let s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(let e of s.step_details.tool_calls)e.index==eE(this,V,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(eE(this,G,"f")&&this._emit("toolCallDone",eE(this,G,"f")),eO(this,V,e.index,"f"),eO(this,G,t.step_details.tool_calls[e.index],"f"),eE(this,G,"f")&&this._emit("toolCallCreated",eE(this,G,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":eO(this,Q,void 0,"f"),"tool_calls"==e.data.step_details.type&&eE(this,G,"f")&&(this._emit("toolCallDone",eE(this,G,"f")),eO(this,G,void 0,"f")),this._emit("runStepDone",e.data,t)}},en=function(e){eE(this,F,"f").push(e),this._emit("event",e)},er=function(e){switch(e.event){case"thread.run.step.created":return eE(this,U,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=eE(this,U,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){let n=W.accumulateDelta(t,s.delta);eE(this,U,"f")[e.data.id]=n}return eE(this,U,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":eE(this,U,"f")[e.data.id]=e.data}if(eE(this,U,"f")[e.data.id])return eE(this,U,"f")[e.data.id];throw Error("No snapshot available")},ea=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(let e of n.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=eE(this,B,"m",ei).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ei=function(e,t){return W.accumulateDelta(t,e)},eo=function(e){switch(eO(this,Y,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":case"thread.run.incomplete":eO(this,H,e.data,"f"),eE(this,G,"f")&&(this._emit("toolCallDone",eE(this,G,"f")),eO(this,G,void 0,"f"))}};class sI extends tH{constructor(){super(...arguments),this.steps=new sx(this._client)}create(e,t,s){let{include:n,...r}=t;return this._client.post(tV`/threads/${e}/runs`,{query:{include:n},body:r,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}retrieve(e,t,s){let{thread_id:n}=t;return this._client.get(tV`/threads/${n}/runs/${e}`,{...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{thread_id:n,...r}=t;return this._client.post(tV`/threads/${n}/runs/${e}`,{body:r,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(tV`/threads/${e}/runs`,tR,{query:t,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{thread_id:n}=t;return this._client.post(tV`/threads/${n}/runs/${e}/cancel`,{...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(n.id,{thread_id:e},s)}createAndStream(e,t,s){return s$.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){let n=sc([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:a}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...n}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let i=5e3;if(s?.pollIntervalMs)i=s.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await eZ(i);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return s$.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s){let{thread_id:n,...r}=t;return this._client.post(tV`/threads/${n}/runs/${e}/submit_tool_outputs`,{body:r,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers]),stream:t.stream??!1})}async submitToolOutputsAndPoll(e,t,s){let n=await this.submitToolOutputs(e,t,s);return await this.poll(n.id,t,s)}submitToolOutputsStream(e,t,s){return s$.createToolAssistantStream(e,this._client.beta.threads.runs,t,s)}}sI.Steps=sx;class sO extends tH{constructor(){super(...arguments),this.runs=new sI(this._client),this.messages=new sS(this._client)}create(e={},t){return this._client.post("/threads",{body:e,...t,headers:sc([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(tV`/threads/${e}`,{...t,headers:sc([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(tV`/threads/${e}`,{body:t,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t){return this._client.delete(tV`/threads/${e}`,{...t,headers:sc([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:sc([{"OpenAI-Beta":"assistants=v2"},t?.headers]),stream:e.stream??!1})}async createAndRunPoll(e,t){let s=await this.createAndRun(e,t);return await this.runs.poll(s.id,{thread_id:s.thread_id},t)}createAndRunStream(e,t){return s$.createThreadAssistantStream(e,this._client.beta.threads,t)}}sO.Runs=sI,sO.Messages=sS;class sE extends tH{constructor(){super(...arguments),this.realtime=new sy(this._client),this.chatkit=new sv(this._client),this.assistants=new sm(this._client),this.threads=new sO(this._client)}}sE.Realtime=sy,sE.ChatKit=sv,sE.Assistants=sm,sE.Threads=sO;class sR extends tH{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}class sk extends tH{retrieve(e,t,s){let{container_id:n}=t;return this._client.get(tV`/containers/${n}/files/${e}/content`,{...s,headers:sc([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}}class sP extends tH{constructor(){super(...arguments),this.content=new sk(this._client)}create(e,t,s){return this._client.post(tV`/containers/${e}/files`,tj({body:t,...s},this._client))}retrieve(e,t,s){let{container_id:n}=t;return this._client.get(tV`/containers/${n}/files/${e}`,s)}list(e,t={},s){return this._client.getAPIList(tV`/containers/${e}/files`,tR,{query:t,...s})}delete(e,t,s){let{container_id:n}=t;return this._client.delete(tV`/containers/${n}/files/${e}`,{...s,headers:sc([{Accept:"*/*"},s?.headers])})}}sP.Content=sk;class sT extends tH{constructor(){super(...arguments),this.files=new sP(this._client)}create(e,t){return this._client.post("/containers",{body:e,...t})}retrieve(e,t){return this._client.get(tV`/containers/${e}`,t)}list(e={},t){return this._client.getAPIList("/containers",tR,{query:e,...t})}delete(e,t){return this._client.delete(tV`/containers/${e}`,{...t,headers:sc([{Accept:"*/*"},t?.headers])})}}sT.Files=sP;class sC extends tH{create(e,t,s){let{include:n,...r}=t;return this._client.post(tV`/conversations/${e}/items`,{query:{include:n},body:r,...s})}retrieve(e,t,s){let{conversation_id:n,...r}=t;return this._client.get(tV`/conversations/${n}/items/${e}`,{query:r,...s})}list(e,t={},s){return this._client.getAPIList(tV`/conversations/${e}/items`,tk,{query:t,...s})}delete(e,t,s){let{conversation_id:n}=t;return this._client.delete(tV`/conversations/${n}/items/${e}`,s)}}class sN extends tH{constructor(){super(...arguments),this.items=new sC(this._client)}create(e={},t){return this._client.post("/conversations",{body:e,...t})}retrieve(e,t){return this._client.get(tV`/conversations/${e}`,t)}update(e,t,s){return this._client.post(tV`/conversations/${e}`,{body:t,...s})}delete(e,t){return this._client.delete(tV`/conversations/${e}`,t)}}sN.Items=sC;class sM extends tH{create(e,t){let s=!!e.encoding_format,n=s?e.encoding_format:"base64";s&&t_(this._client).debug("embeddings/user defined encoding_format:",e.encoding_format);let r=this._client.post("/embeddings",{body:{...e,encoding_format:n},...t});return s?r:(t_(this._client).debug("embeddings/decoding base64 embeddings from base64"),r._thenUnwrap(e=>(e&&e.data&&e.data.forEach(e=>{let t=e.embedding;e.embedding=(e=>{if("u">typeof Buffer){let t=Buffer.from(e,"base64");return Array.from(new Float32Array(t.buffer,t.byteOffset,t.length/Float32Array.BYTES_PER_ELEMENT))}{let t=atob(e),s=t.length,n=new Uint8Array(s);for(let e=0;e<s;e++)n[e]=t.charCodeAt(e);return Array.from(new Float32Array(n.buffer))}})(t)}),e)))}}class sj extends tH{retrieve(e,t,s){let{eval_id:n,run_id:r}=t;return this._client.get(tV`/evals/${n}/runs/${r}/output_items/${e}`,s)}list(e,t,s){let{eval_id:n,...r}=t;return this._client.getAPIList(tV`/evals/${n}/runs/${e}/output_items`,tR,{query:r,...s})}}class sL extends tH{constructor(){super(...arguments),this.outputItems=new sj(this._client)}create(e,t,s){return this._client.post(tV`/evals/${e}/runs`,{body:t,...s})}retrieve(e,t,s){let{eval_id:n}=t;return this._client.get(tV`/evals/${n}/runs/${e}`,s)}list(e,t={},s){return this._client.getAPIList(tV`/evals/${e}/runs`,tR,{query:t,...s})}delete(e,t,s){let{eval_id:n}=t;return this._client.delete(tV`/evals/${n}/runs/${e}`,s)}cancel(e,t,s){let{eval_id:n}=t;return this._client.post(tV`/evals/${n}/runs/${e}`,s)}}sL.OutputItems=sj;class sD extends tH{constructor(){super(...arguments),this.runs=new sL(this._client)}create(e,t){return this._client.post("/evals",{body:e,...t})}retrieve(e,t){return this._client.get(tV`/evals/${e}`,t)}update(e,t,s){return this._client.post(tV`/evals/${e}`,{body:t,...s})}list(e={},t){return this._client.getAPIList("/evals",tR,{query:e,...t})}delete(e,t){return this._client.delete(tV`/evals/${e}`,t)}}sD.Runs=sL;class sB extends tH{create(e,t){return this._client.post("/files",tj({body:e,...t},this._client))}retrieve(e,t){return this._client.get(tV`/files/${e}`,t)}list(e={},t){return this._client.getAPIList("/files",tR,{query:e,...t})}delete(e,t){return this._client.delete(tV`/files/${e}`,t)}content(e,t){return this._client.get(tV`/files/${e}/content`,{...t,headers:sc([{Accept:"application/binary"},t?.headers]),__binaryResponse:!0})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){let n=new Set(["processed","error","deleted"]),r=Date.now(),a=await this.retrieve(e);for(;!a.status||!n.has(a.status);)if(await eZ(t),a=await this.retrieve(e),Date.now()-r>s)throw new ej({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return a}}class sW extends tH{}class sF extends tH{run(e,t){return this._client.post("/fine_tuning/alpha/graders/run",{body:e,...t})}validate(e,t){return this._client.post("/fine_tuning/alpha/graders/validate",{body:e,...t})}}class sU extends tH{constructor(){super(...arguments),this.graders=new sF(this._client)}}sU.Graders=sF;class sq extends tH{create(e,t,s){return this._client.getAPIList(tV`/fine_tuning/checkpoints/${e}/permissions`,tE,{body:t,method:"post",...s})}retrieve(e,t={},s){return this._client.get(tV`/fine_tuning/checkpoints/${e}/permissions`,{query:t,...s})}delete(e,t,s){let{fine_tuned_model_checkpoint:n}=t;return this._client.delete(tV`/fine_tuning/checkpoints/${n}/permissions/${e}`,s)}}class sX extends tH{constructor(){super(...arguments),this.permissions=new sq(this._client)}}sX.Permissions=sq;class sH extends tH{list(e,t={},s){return this._client.getAPIList(tV`/fine_tuning/jobs/${e}/checkpoints`,tR,{query:t,...s})}}class sJ extends tH{constructor(){super(...arguments),this.checkpoints=new sH(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(tV`/fine_tuning/jobs/${e}`,t)}list(e={},t){return this._client.getAPIList("/fine_tuning/jobs",tR,{query:e,...t})}cancel(e,t){return this._client.post(tV`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return this._client.getAPIList(tV`/fine_tuning/jobs/${e}/events`,tR,{query:t,...s})}pause(e,t){return this._client.post(tV`/fine_tuning/jobs/${e}/pause`,t)}resume(e,t){return this._client.post(tV`/fine_tuning/jobs/${e}/resume`,t)}}sJ.Checkpoints=sH;class sK extends tH{constructor(){super(...arguments),this.methods=new sW(this._client),this.jobs=new sJ(this._client),this.checkpoints=new sX(this._client),this.alpha=new sU(this._client)}}sK.Methods=sW,sK.Jobs=sJ,sK.Checkpoints=sX,sK.Alpha=sU;class sV extends tH{}class sG extends tH{constructor(){super(...arguments),this.graderModels=new sV(this._client)}}sG.GraderModels=sV;class sz extends tH{createVariation(e,t){return this._client.post("/images/variations",tj({body:e,...t},this._client))}edit(e,t){return this._client.post("/images/edits",tj({body:e,...t,stream:e.stream??!1},this._client))}generate(e,t){return this._client.post("/images/generations",{body:e,...t,stream:e.stream??!1})}}class sY extends tH{retrieve(e,t){return this._client.get(tV`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",tE,e)}delete(e,t){return this._client.delete(tV`/models/${e}`,t)}}class sQ extends tH{create(e,t){return this._client.post("/moderations",{body:e,...t})}}class sZ extends tH{accept(e,t,s){return this._client.post(tV`/realtime/calls/${e}/accept`,{body:t,...s,headers:sc([{Accept:"*/*"},s?.headers])})}hangup(e,t){return this._client.post(tV`/realtime/calls/${e}/hangup`,{...t,headers:sc([{Accept:"*/*"},t?.headers])})}refer(e,t,s){return this._client.post(tV`/realtime/calls/${e}/refer`,{body:t,...s,headers:sc([{Accept:"*/*"},s?.headers])})}reject(e,t={},s){return this._client.post(tV`/realtime/calls/${e}/reject`,{body:t,...s,headers:sc([{Accept:"*/*"},s?.headers])})}}class s0 extends tH{create(e,t){return this._client.post("/realtime/client_secrets",{body:e,...t})}}class s1 extends tH{constructor(){super(...arguments),this.clientSecrets=new s0(this._client),this.calls=new sZ(this._client)}}function s2(e,t){let s=e.output.map(e=>{if("function_call"===e.type)return{...e,parsed_arguments:function(e,t){var s,n;let r=(s=e.tools??[],n=t.name,s.find(e=>"function"===e.type&&e.name===n));return{...t,...t,parsed_arguments:r?.$brand==="auto-parseable-tool"?r.$parseRaw(t.arguments):r?.strict?JSON.parse(t.arguments):null}}(t,e)};if("message"===e.type){let s=e.content.map(e=>{var s,n;return"output_text"===e.type?{...e,parsed:(s=t,n=e.text,s.text?.format?.type!=="json_schema"?null:"$parseRaw"in s.text?.format?(s.text?.format).$parseRaw(n):JSON.parse(n))}:e});return{...e,content:s}}return e}),n=Object.assign({},e,{output:s});return Object.getOwnPropertyDescriptor(e,"output_text")||s3(n),Object.defineProperty(n,"output_parsed",{enumerable:!0,get(){for(let e of n.output)if("message"===e.type){for(let t of e.content)if("output_text"===t.type&&null!==t.parsed)return t.parsed}return null}}),n}function s3(e){let t=[];for(let s of e.output)if("message"===s.type)for(let e of s.content)"output_text"===e.type&&t.push(e.text);e.output_text=t.join("")}s1.ClientSecrets=s0,s1.Calls=sZ;class s4 extends t4{constructor(e){super(),el.add(this),ec.set(this,void 0),eh.set(this,void 0),eu.set(this,void 0),eO(this,ec,e,"f")}static createResponse(e,t,s){let n=new s4(t);return n._run(()=>n._createOrRetrieveResponse(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),n}async _createOrRetrieveResponse(e,t,s){let n,r=s?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",()=>this.controller.abort())),eE(this,el,"m",ed).call(this);let a=null;for await(let r of("response_id"in t?(n=await e.responses.retrieve(t.response_id,{stream:!0},{...s,signal:this.controller.signal,stream:!0}),a=t.starting_after??null):n=await e.responses.create({...t,stream:!0},{...s,signal:this.controller.signal}),this._connected(),n))eE(this,el,"m",ef).call(this,r,a);if(n.controller.signal?.aborted)throw new eN;return eE(this,el,"m",ep).call(this)}[(ec=new WeakMap,eh=new WeakMap,eu=new WeakMap,el=new WeakSet,ed=function(){this.ended||eO(this,eh,void 0,"f")},ef=function(e,t){if(this.ended)return;let s=(e,s)=>{(null==t||s.sequence_number>t)&&this._emit(e,s)},n=eE(this,el,"m",em).call(this,e);switch(s("event",e),e.type){case"response.output_text.delta":{let t=n.output[e.output_index];if(!t)throw new eT(`missing output at index ${e.output_index}`);if("message"===t.type){let n=t.content[e.content_index];if(!n)throw new eT(`missing content at index ${e.content_index}`);if("output_text"!==n.type)throw new eT(`expected content to be 'output_text', got ${n.type}`);s("response.output_text.delta",{...e,snapshot:n.text})}break}case"response.function_call_arguments.delta":{let t=n.output[e.output_index];if(!t)throw new eT(`missing output at index ${e.output_index}`);"function_call"===t.type&&s("response.function_call_arguments.delta",{...e,snapshot:t.arguments});break}default:s(e.type,e)}},ep=function(){if(this.ended)throw new eT("stream has ended, this shouldn't happen");let e=eE(this,eh,"f");if(!e)throw new eT("request ended without sending any events");eO(this,eh,void 0,"f");let t=function(e,t){var s;return t&&(s=t,tY(s.text?.format))?s2(e,t):{...e,output_parsed:null,output:e.output.map(e=>"function_call"===e.type?{...e,parsed_arguments:null}:"message"===e.type?{...e,content:e.content.map(e=>({...e,parsed:null}))}:e)}}(e,eE(this,ec,"f"));return eO(this,eu,t,"f"),t},em=function(e){let t=eE(this,eh,"f");if(!t){if("response.created"!==e.type)throw new eT(`When snapshot hasn't been set yet, expected 'response.created' event, got ${e.type}`);return eO(this,eh,e.response,"f")}switch(e.type){case"response.output_item.added":t.output.push(e.item);break;case"response.content_part.added":{let s=t.output[e.output_index];if(!s)throw new eT(`missing output at index ${e.output_index}`);let n=s.type,r=e.part;"message"===n&&"reasoning_text"!==r.type?s.content.push(r):"reasoning"===n&&"reasoning_text"===r.type&&(s.content||(s.content=[]),s.content.push(r));break}case"response.output_text.delta":{let s=t.output[e.output_index];if(!s)throw new eT(`missing output at index ${e.output_index}`);if("message"===s.type){let t=s.content[e.content_index];if(!t)throw new eT(`missing content at index ${e.content_index}`);if("output_text"!==t.type)throw new eT(`expected content to be 'output_text', got ${t.type}`);t.text+=e.delta}break}case"response.function_call_arguments.delta":{let s=t.output[e.output_index];if(!s)throw new eT(`missing output at index ${e.output_index}`);"function_call"===s.type&&(s.arguments+=e.delta);break}case"response.reasoning_text.delta":{let s=t.output[e.output_index];if(!s)throw new eT(`missing output at index ${e.output_index}`);if("reasoning"===s.type){let t=s.content?.[e.content_index];if(!t)throw new eT(`missing content at index ${e.content_index}`);if("reasoning_text"!==t.type)throw new eT(`expected content to be 'reasoning_text', got ${t.type}`);t.text+=e.delta}break}case"response.completed":eO(this,eh,e.response,"f")}return t},Symbol.asyncIterator)](){let e=[],t=[],s=!1;return this.on("event",s=>{let n=t.shift();n?n.resolve(s):e.push(s)}),this.on("end",()=>{for(let e of(s=!0,t))e.resolve(void 0);t.length=0}),this.on("abort",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),this.on("error",e=>{for(let n of(s=!0,t))n.reject(e);t.length=0}),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((e,s)=>t.push({resolve:e,reject:s})).then(e=>e?{value:e,done:!1}:{value:void 0,done:!0}),return:async()=>(this.abort(),{value:void 0,done:!0})}}async finalResponse(){await this.done();let e=eE(this,eu,"f");if(!e)throw new eT("stream ended without producing a ChatCompletion");return e}}class s6 extends tH{list(e,t={},s){return this._client.getAPIList(tV`/responses/${e}/input_items`,tR,{query:t,...s})}}class s8 extends tH{count(e={},t){return this._client.post("/responses/input_tokens",{body:e,...t})}}class s5 extends tH{constructor(){super(...arguments),this.inputItems=new s6(this._client),this.inputTokens=new s8(this._client)}create(e,t){return this._client.post("/responses",{body:e,...t,stream:e.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&s3(e),e))}retrieve(e,t={},s){return this._client.get(tV`/responses/${e}`,{query:t,...s,stream:t?.stream??!1})._thenUnwrap(e=>("object"in e&&"response"===e.object&&s3(e),e))}delete(e,t){return this._client.delete(tV`/responses/${e}`,{...t,headers:sc([{Accept:"*/*"},t?.headers])})}parse(e,t){return this._client.responses.create(e,t)._thenUnwrap(t=>s2(t,e))}stream(e,t){return s4.createResponse(this._client,e,t)}cancel(e,t){return this._client.post(tV`/responses/${e}/cancel`,t)}compact(e,t){return this._client.post("/responses/compact",{body:e,...t})}}s5.InputItems=s6,s5.InputTokens=s8;class s9 extends tH{create(e,t,s){return this._client.post(tV`/uploads/${e}/parts`,tj({body:t,...s},this._client))}}class s7 extends tH{constructor(){super(...arguments),this.parts=new s9(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(tV`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(tV`/uploads/${e}/complete`,{body:t,...s})}}s7.Parts=s9;let ne=async e=>{let t=await Promise.allSettled(e),s=t.filter(e=>"rejected"===e.status);if(s.length){for(let e of s)console.error(e.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let n=[];for(let e of t)"fulfilled"===e.status&&n.push(e.value);return n};class nt extends tH{create(e,t,s){return this._client.post(tV`/vector_stores/${e}/file_batches`,{body:t,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(tV`/vector_stores/${n}/file_batches/${e}`,{...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}cancel(e,t,s){let{vector_store_id:n}=t;return this._client.post(tV`/vector_stores/${n}/file_batches/${e}/cancel`,{...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s){let{vector_store_id:n,...r}=t;return this._client.getAPIList(tV`/vector_stores/${n}/file_batches/${e}/files`,tR,{query:r,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async poll(e,t,s){let n=sc([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let{data:r,response:a}=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse();switch(r.status){case"in_progress":let i=5e3;if(s?.pollIntervalMs)i=s.pollIntervalMs;else{let e=a.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await eZ(i);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(null==t||0==t.length)throw Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");let r=Math.min(n?.maxConcurrency??5,t.length),a=this._client,i=t.values(),o=[...s];async function l(e){for(let t of e){let e=await a.files.create({file:t,purpose:"assistants"},n);o.push(e.id)}}let c=Array(r).fill(i).map(l);return await ne(c),await this.createAndPoll(e,{file_ids:o})}}class ns extends tH{create(e,t,s){return this._client.post(tV`/vector_stores/${e}/files`,{body:t,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}retrieve(e,t,s){let{vector_store_id:n}=t;return this._client.get(tV`/vector_stores/${n}/files/${e}`,{...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}update(e,t,s){let{vector_store_id:n,...r}=t;return this._client.post(tV`/vector_stores/${n}/files/${e}`,{body:r,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e,t={},s){return this._client.getAPIList(tV`/vector_stores/${e}/files`,tR,{query:t,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}delete(e,t,s){let{vector_store_id:n}=t;return this._client.delete(tV`/vector_stores/${n}/files/${e}`,{...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}async createAndPoll(e,t,s){let n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){let n=sc([s?.headers,{"X-Stainless-Poll-Helper":"true","X-Stainless-Custom-Poll-Interval":s?.pollIntervalMs?.toString()??void 0}]);for(;;){let r=await this.retrieve(t,{vector_store_id:e},{...s,headers:n}).withResponse(),a=r.data;switch(a.status){case"in_progress":let i=5e3;if(s?.pollIntervalMs)i=s.pollIntervalMs;else{let e=r.response.headers.get("openai-poll-after-ms");if(e){let t=parseInt(e);isNaN(t)||(i=t)}}await eZ(i);break;case"failed":case"completed":return a}}}async upload(e,t,s){let n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){let n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}content(e,t,s){let{vector_store_id:n}=t;return this._client.getAPIList(tV`/vector_stores/${n}/files/${e}/content`,tE,{...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}class nn extends tH{constructor(){super(...arguments),this.files=new ns(this._client),this.fileBatches=new nt(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:sc([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}retrieve(e,t){return this._client.get(tV`/vector_stores/${e}`,{...t,headers:sc([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}update(e,t,s){return this._client.post(tV`/vector_stores/${e}`,{body:t,...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}list(e={},t){return this._client.getAPIList("/vector_stores",tR,{query:e,...t,headers:sc([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}delete(e,t){return this._client.delete(tV`/vector_stores/${e}`,{...t,headers:sc([{"OpenAI-Beta":"assistants=v2"},t?.headers])})}search(e,t,s){return this._client.getAPIList(tV`/vector_stores/${e}/search`,tE,{body:t,method:"post",...s,headers:sc([{"OpenAI-Beta":"assistants=v2"},s?.headers])})}}nn.Files=ns,nn.FileBatches=nt;class nr extends tH{create(e,t){return this._client.post("/videos",tM({body:e,...t},this._client))}retrieve(e,t){return this._client.get(tV`/videos/${e}`,t)}list(e={},t){return this._client.getAPIList("/videos",tk,{query:e,...t})}delete(e,t){return this._client.delete(tV`/videos/${e}`,t)}downloadContent(e,t={},s){return this._client.get(tV`/videos/${e}/content`,{query:t,...s,headers:sc([{Accept:"application/binary"},s?.headers]),__binaryResponse:!0})}remix(e,t,s){return this._client.post(tV`/videos/${e}/remix`,tM({body:t,...s},this._client))}}class na extends tH{constructor(){super(...arguments),eg.add(this)}async unwrap(e,t,s=this._client.webhookSecret,n=300){return await this.verifySignature(e,t,s,n),JSON.parse(e)}async verifySignature(e,t,s=this._client.webhookSecret,n=300){if("u"<typeof crypto||"function"!=typeof crypto.subtle.importKey||"function"!=typeof crypto.subtle.verify)throw Error("Webhook signature verification is only supported when the `crypto` global is defined");eE(this,eg,"m",e_).call(this,s);let r=sc([t]).values,a=eE(this,eg,"m",ey).call(this,r,"webhook-signature"),i=eE(this,eg,"m",ey).call(this,r,"webhook-timestamp"),o=eE(this,eg,"m",ey).call(this,r,"webhook-id"),l=parseInt(i,10);if(isNaN(l))throw new eK("Invalid webhook timestamp format");let c=Math.floor(Date.now()/1e3);if(c-l>n)throw new eK("Webhook timestamp is too old");if(l>c+n)throw new eK("Webhook timestamp is too new");let h=a.split(" ").map(e=>e.startsWith("v1,")?e.substring(3):e),u=s.startsWith("whsec_")?Buffer.from(s.replace("whsec_",""),"base64"):Buffer.from(s,"utf-8"),d=o?`${o}.${i}.${e}`:`${i}.${e}`,f=await crypto.subtle.importKey("raw",u,{name:"HMAC",hash:"SHA-256"},!1,["verify"]);for(let e of h)try{let t=Buffer.from(e,"base64");if(await crypto.subtle.verify("HMAC",f,t,new TextEncoder().encode(d)))return}catch{continue}throw new eK("The given webhook signature does not match the expected signature")}}eg=new WeakSet,e_=function(e){if("string"!=typeof e||0===e.length)throw Error("The webhook secret must either be set using the env var, OPENAI_WEBHOOK_SECRET, on the client class, OpenAI({ webhookSecret: '123' }), or passed to this function")},ey=function(e,t){if(!e)throw Error("Headers are required");let s=e.get(t);if(null==s)throw Error(`Missing required header: ${t}`);return s},e.i(16960);class ni{constructor({baseURL:e=sA("OPENAI_BASE_URL"),apiKey:t=sA("OPENAI_API_KEY"),organization:s=sA("OPENAI_ORG_ID")??null,project:n=sA("OPENAI_PROJECT_ID")??null,webhookSecret:r=sA("OPENAI_WEBHOOK_SECRET")??null,...a}={}){if(ew.add(this),ev.set(this,void 0),this.completions=new sR(this),this.chat=new so(this),this.embeddings=new sM(this),this.files=new sB(this),this.images=new sz(this),this.audio=new sf(this),this.moderations=new sQ(this),this.models=new sY(this),this.fineTuning=new sK(this),this.graders=new sG(this),this.vectorStores=new nn(this),this.webhooks=new na(this),this.beta=new sE(this),this.batches=new sp(this),this.uploads=new s7(this),this.responses=new s5(this),this.realtime=new s1(this),this.conversations=new sN(this),this.evals=new sD(this),this.containers=new sT(this),this.videos=new nr(this),void 0===t)throw new eT("Missing credentials. Please pass an `apiKey`, or set the `OPENAI_API_KEY` environment variable.");const i={apiKey:t,organization:s,project:n,webhookSecret:r,...a,baseURL:e||"https://api.openai.com/v1"};i.dangerouslyAllowBrowser,this.baseURL=i.baseURL,this.timeout=i.timeout??eb.DEFAULT_TIMEOUT,this.logger=i.logger??console;const o="warn";this.logLevel=o,this.logLevel=td(i.logLevel,"ClientOptions.logLevel",this)??td(sA("OPENAI_LOG"),"process.env['OPENAI_LOG']",this)??o,this.fetchOptions=i.fetchOptions,this.maxRetries=i.maxRetries??2,this.fetch=i.fetch??function(){if("u">typeof fetch)return fetch;throw Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new OpenAI({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}(),eO(this,ev,e5,"f"),this._options=i,this.apiKey="string"==typeof t?t:"Missing Key",this.organization=s,this.project=n,this.webhookSecret=r}withOptions(e){return new this.constructor({...this._options,baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,organization:this.organization,project:this.project,webhookSecret:this.webhookSecret,...e})}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){}async authHeaders(e){return sc([{Authorization:`Bearer ${this.apiKey}`}])}stringifyQuery(e){return function(e,t={}){let s,n=e,r=function(e=ti){let t;if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw TypeError("Encoder has to be a function.");let s=e.charset||ti.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let n=e9;if(void 0!==e.format){if(!tt(te,e.format))throw TypeError("Unknown format option provided.");n=e.format}let r=te[n],a=ti.filter;if(("function"==typeof e.filter||eG(e.filter))&&(a=e.filter),t=e.arrayFormat&&e.arrayFormat in tr?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":ti.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw TypeError("`commaRoundTrip` must be a boolean, or absent");let i=void 0===e.allowDots?!0==!!e.encodeDotInKeys||ti.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:ti.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:ti.allowEmptyArrays,arrayFormat:t,charset:s,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:ti.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?ti.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:ti.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:ti.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:ti.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:ti.encodeValuesOnly,filter:a,format:n,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:ti.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:ti.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:ti.strictNullHandling}}(t);"function"==typeof r.filter?n=(0,r.filter)("",n):eG(r.filter)&&(s=r.filter);let a=[];if("object"!=typeof n||null===n)return"";let i=tr[r.arrayFormat],o="comma"===i&&r.commaRoundTrip;s||(s=Object.keys(n)),r.sort&&s.sort(r.sort);let l=new WeakMap;for(let e=0;e<s.length;++e){let t=s[e];r.skipNulls&&null===n[t]||ta(a,function e(t,s,n,r,a,i,o,l,c,h,u,d,f,p,m,g,_,y){var w,b;let v,S=t,x=y,A=0,$=!1;for(;void 0!==(x=x.get(to))&&!$;){let e=x.get(t);if(A+=1,void 0!==e)if(e===A)throw RangeError("Cyclic object value");else $=!0;void 0===x.get(to)&&(A=0)}if("function"==typeof h?S=h(s,S):S instanceof Date?S=f?.(S):"comma"===n&&eG(S)&&(S=tn(S,function(e){return e instanceof Date?f?.(e):e})),null===S){if(i)return c&&!g?c(s,ti.encoder,_,"key",p):s;S=""}if("string"==typeof(w=S)||"number"==typeof w||"boolean"==typeof w||"symbol"==typeof w||"bigint"==typeof w||(b=S)&&"object"==typeof b&&b.constructor&&b.constructor.isBuffer&&b.constructor.isBuffer(b)){if(c){let e=g?s:c(s,ti.encoder,_,"key",p);return[m?.(e)+"="+m?.(c(S,ti.encoder,_,"value",p))]}return[m?.(s)+"="+m?.(String(S))]}let I=[];if(void 0===S)return I;if("comma"===n&&eG(S))g&&c&&(S=tn(S,c)),v=[{value:S.length>0?S.join(",")||null:void 0}];else if(eG(h))v=h;else{let e=Object.keys(S);v=u?e.sort(u):e}let O=l?String(s).replace(/\./g,"%2E"):String(s),E=r&&eG(S)&&1===S.length?O+"[]":O;if(a&&eG(S)&&0===S.length)return E+"[]";for(let s=0;s<v.length;++s){let w=v[s],b="object"==typeof w&&void 0!==w.value?w.value:S[w];if(o&&null===b)continue;let x=d&&l?w.replace(/\./g,"%2E"):w,$=eG(S)?"function"==typeof n?n(E,x):E:E+(d?"."+x:"["+x+"]");y.set(t,A);let O=new WeakMap;O.set(to,y),ta(I,e(b,$,n,r,a,i,o,l,"comma"===n&&g&&eG(S)?null:c,h,u,d,f,p,m,g,_,O))}return I}(n[t],t,i,o,r.allowEmptyArrays,r.strictNullHandling,r.skipNulls,r.encodeDotInKeys,r.encode?r.encoder:null,r.filter,r.sort,r.allowDots,r.serializeDate,r.format,r.formatter,r.encodeValuesOnly,r.charset,l))}let c=a.join(r.delimiter),h=!0===r.addQueryPrefix?"?":"";return r.charsetSentinel&&("iso-8859-1"===r.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),c.length>0?h+c:""}(e,{arrayFormat:"brackets"})}getUserAgent(){return`${this.constructor.name}/JS ${e0}`}defaultIdempotencyKey(){return`stainless-node-retry-${eR()}`}makeStatusError(e,t,s,n){return eC.generate(e,t,s,n)}async _callApiKey(){let e,t=this._options.apiKey;if("function"!=typeof t)return!1;try{e=await t()}catch(e){if(e instanceof eT)throw e;throw new eT(`Failed to get token from 'apiKey' function: ${e.message}`,{cause:e})}if("string"!=typeof e||!e)throw new eT(`Expected 'apiKey' function argument to return a string but it returned ${e}`);return this.apiKey=e,!0}buildURL(e,t,s){let n=!eE(this,ew,"m",eS).call(this)&&s||this.baseURL,r=new URL(eV.test(e)?e:n+(n.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),a=this.defaultQuery();return!function(e){if(!e)return!0;for(let t in e)return!1;return!0}(a)&&(t={...a,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(r.search=this.stringifyQuery(t)),r.toString()}async prepareOptions(e){await this._callApiKey()}async prepareRequest(e,{url:t,options:s}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then(s=>({method:e,path:t,...s})))}request(e,t=null){return new t$(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,s){let n=await e,r=n.maxRetries??this.maxRetries;null==t&&(t=r),await this.prepareOptions(n);let{req:a,url:i,timeout:o}=await this.buildRequest(n,{retryCount:r-t});await this.prepareRequest(a,{url:i,options:n});let l="log_"+(0x1000000*Math.random()|0).toString(16).padStart(6,"0"),c=void 0===s?"":`, retryOf: ${s}`,h=Date.now();if(t_(this).debug(`[${l}] sending request`,ty({retryOfRequestLogID:s,method:n.method,url:i,options:n,headers:a.headers})),n.signal?.aborted)throw new eN;let u=new AbortController,d=await this.fetchWithTimeout(i,a,o,u).catch(eP),f=Date.now();if(d instanceof globalThis.Error){let e=`retrying, ${t} attempts remaining`;if(n.signal?.aborted)throw new eN;let r=ek(d)||/timed? ?out/i.test(String(d)+("cause"in d?String(d.cause):""));if(t)return t_(this).info(`[${l}] connection ${r?"timed out":"failed"} - ${e}`),t_(this).debug(`[${l}] connection ${r?"timed out":"failed"} (${e})`,ty({retryOfRequestLogID:s,url:i,durationMs:f-h,message:d.message})),this.retryRequest(n,t,s??l);if(t_(this).info(`[${l}] connection ${r?"timed out":"failed"} - error; no more retries left`),t_(this).debug(`[${l}] connection ${r?"timed out":"failed"} (error; no more retries left)`,ty({retryOfRequestLogID:s,url:i,durationMs:f-h,message:d.message})),r)throw new ej;throw new eM({cause:d})}let p=[...d.headers.entries()].filter(([e])=>"x-request-id"===e).map(([e,t])=>", "+e+": "+JSON.stringify(t)).join(""),m=`[${l}${c}${p}] ${a.method} ${i} ${d.ok?"succeeded":"failed"} with status ${d.status} in ${f-h}ms`;if(!d.ok){let e=await this.shouldRetry(d);if(t&&e){let e=`retrying, ${t} attempts remaining`;return await e8(d.body),t_(this).info(`${m} - ${e}`),t_(this).debug(`[${l}] response error (${e})`,ty({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:f-h})),this.retryRequest(n,t,s??l,d.headers)}let r=e?"error; no more retries left":"error; not retryable";t_(this).info(`${m} - ${r}`);let a=await d.text().catch(e=>eP(e).message),i=(e=>{try{return JSON.parse(e)}catch(e){return}})(a),o=i?void 0:a;throw t_(this).debug(`[${l}] response error (${r})`,ty({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,message:o,durationMs:Date.now()-h})),this.makeStatusError(d.status,i,o,d.headers)}return t_(this).info(m),t_(this).debug(`[${l}] response start`,ty({retryOfRequestLogID:s,url:d.url,status:d.status,headers:d.headers,durationMs:f-h})),{response:d,options:n,controller:u,requestLogID:l,retryOfRequestLogID:s,startTime:h}}getAPIList(e,t,s){return this.requestAPIList(t,s&&"then"in s?s.then(t=>({method:"get",path:e,...t})):{method:"get",path:e,...s})}requestAPIList(e,t){return new tO(this,this.makeRequest(t,null,void 0),e)}async fetchWithTimeout(e,t,s,n){let{signal:r,method:a,...i}=t||{},o=this._makeAbort(n);r&&r.addEventListener("abort",o,{once:!0});let l=setTimeout(o,s),c=globalThis.ReadableStream&&i.body instanceof globalThis.ReadableStream||"object"==typeof i.body&&null!==i.body&&Symbol.asyncIterator in i.body,h={signal:n.signal,...c?{duplex:"half"}:{},method:"GET",...i};a&&(h.method=a.toUpperCase());try{return await this.fetch.call(void 0,e,h)}finally{clearTimeout(l)}}async shouldRetry(e){let t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||!!(e.status>=500))}async retryRequest(e,t,s,n){let r,a=n?.get("retry-after-ms");if(a){let e=parseFloat(a);Number.isNaN(e)||(r=e)}let i=n?.get("retry-after");if(i&&!r){let e=parseFloat(i);r=Number.isNaN(e)?Date.parse(i)-Date.now():1e3*e}if(!(r&&0<=r&&r<6e4)){let s=e.maxRetries??this.maxRetries;r=this.calculateDefaultRetryTimeoutMillis(t,s)}return await eZ(r),this.makeRequest(e,t-1,s)}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}async buildRequest(e,{retryCount:t=0}={}){let s={...e},{method:n,path:r,query:a,defaultBaseURL:i}=s,o=this.buildURL(r,a,i);"timeout"in s&&((e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new eT(`${e} must be an integer`);if(t<0)throw new eT(`${e} must be a positive integer`)})("timeout",s.timeout),s.timeout=s.timeout??this.timeout;let{bodyHeaders:l,body:c}=this.buildBody({options:s}),h=await this.buildHeaders({options:e,method:n,bodyHeaders:l,retryCount:t});return{req:{method:n,headers:h,...s.signal&&{signal:s.signal},...globalThis.ReadableStream&&c instanceof globalThis.ReadableStream&&{duplex:"half"},...c&&{body:c},...this.fetchOptions??{},...s.fetchOptions??{}},url:o,timeout:s.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:s,retryCount:n}){let r={};this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),r[this.idempotencyHeader]=e.idempotencyKey);let a=sc([r,{Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(n),...e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{},...ex??(ex=(()=>{let e="u">typeof Deno&&null!=Deno.build?"deno":"u">typeof EdgeRuntime?"edge":"[object process]"===Object.prototype.toString.call(void 0!==globalThis.process?globalThis.process:0)?"node":"unknown";if("deno"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e0,"X-Stainless-OS":e2(Deno.build.os),"X-Stainless-Arch":e1(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("u">typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e0,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if("node"===e)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e0,"X-Stainless-OS":e2(globalThis.process.platform??"unknown"),"X-Stainless-Arch":e1(globalThis.process.arch??"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":globalThis.process.version??"unknown"};let t=function(){if("u"<typeof navigator||!navigator)return null;for(let{key:e,pattern:t}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=t.exec(navigator.userAgent);if(s){let t=s[1]||0,n=s[2]||0,r=s[3]||0;return{browser:e,version:`${t}.${n}.${r}`}}}return null}();return t?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e0,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${t.browser}`,"X-Stainless-Runtime-Version":t.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e0,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project},await this.authHeaders(e),this._options.defaultHeaders,s,e.headers]);return this.validateHeaders(a),a.values}_makeAbort(e){return()=>e.abort()}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};let s=sc([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||"string"==typeof e&&s.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:"object"==typeof e&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&"function"==typeof e.next)?{bodyHeaders:void 0,body:e4(e)}:eE(this,ev,"f").call(this,{body:e,headers:s})}}eb=ni,ev=new WeakMap,ew=new WeakSet,eS=function(){return"https://api.openai.com/v1"!==this.baseURL},ni.OpenAI=eb,ni.DEFAULT_TIMEOUT=6e5,ni.OpenAIError=eT,ni.APIError=eC,ni.APIConnectionError=eM,ni.APIConnectionTimeoutError=ej,ni.APIUserAbortError=eN,ni.NotFoundError=eW,ni.ConflictError=eF,ni.RateLimitError=eq,ni.BadRequestError=eL,ni.AuthenticationError=eD,ni.InternalServerError=eX,ni.PermissionDeniedError=eB,ni.UnprocessableEntityError=eU,ni.InvalidWebhookSignatureError=eK,ni.toFile=tq,ni.Completions=sR,ni.Chat=so,ni.Embeddings=sM,ni.Files=sB,ni.Images=sz,ni.Audio=sf,ni.Moderations=sQ,ni.Models=sY,ni.FineTuning=sK,ni.Graders=sG,ni.VectorStores=nn,ni.Webhooks=na,ni.Beta=sE,ni.Batches=sp,ni.Uploads=s7,ni.Responses=s5,ni.Realtime=s1,ni.Conversations=sN,ni.Evals=sD,ni.Containers=sT,ni.Videos=nr,e.s([],51211),e.s(["default",()=>ni],36799)},91798,e=>{"use strict";e.s(["AI_ACTIONS",0,["rewrite","shorten","tldr"],"DEFAULT_STYLE_PROFILE",0,"Conversational, engaging tone with short paragraphs and bold key takeaways","ERROR_MESSAGES",0,{UNAUTHORIZED:"Unauthorized",MISSING_PARAMS:"Required parameters missing",NOT_FOUND:"Resource not found",AI_FAILED:"AI processing failed",PUBLISH_FAILED:"Failed to publish",CURATE_FAILED:"Failed to curate articles",DRAFT_FAILED:"Failed to generate draft"},"OPENAI_MODELS",0,{GPT_4O:"gpt-4o",GPT_4O_MINI:"gpt-4o-mini"},"OPENAI_PARAMS",0,{SUMMARIZE:{maxTokens:200,temperature:.3},SCORE_RELEVANCE:{maxTokens:10,temperature:0},GENERATE_DRAFT:{maxTokens:2e3,temperature:.7},SUBJECT_LINES:{maxTokens:300,temperature:.8},REWRITE:{maxTokens:2e3,temperature:.7},SHORTEN:{maxTokens:1500,temperature:.3},TLDR:{maxTokens:200,temperature:.3}},"RSS_CONFIG",0,{MAX_ITEMS:20,USER_AGENT:"LetterFlow/1.0"},"TIMING",0,{DEBOUNCE_MS:2e3,SAVE_DISPLAY_MS:2e3,RSS_CACHE_SEC:3600}])},99429,e=>{"use strict";e.i(51211);var t=e.i(36799),s=e.i(91798);let n=new t.default({apiKey:process.env.OPENAI_API_KEY});async function r(e,t){try{let r=await n.chat.completions.create({model:s.OPENAI_MODELS.GPT_4O_MINI,messages:[{role:"system",content:"You are a content curator for newsletters. Summarize the given article in 2-3 concise sentences, highlighting the key insight that would be most relevant for a newsletter audience."},{role:"user",content:`Title: ${e}

Content: ${t}`}],max_tokens:s.OPENAI_PARAMS.SUMMARIZE.maxTokens,temperature:s.OPENAI_PARAMS.SUMMARIZE.temperature});return r.choices[0]?.message?.content||""}catch(e){throw console.error("summarizeArticle error:",e),Error("Failed to summarize article")}}async function a(e,t,r){try{let a=await n.chat.completions.create({model:s.OPENAI_MODELS.GPT_4O_MINI,messages:[{role:"system",content:"Rate how relevant the given article is to the user's topic keywords on a scale of 0-100. Return ONLY the number, nothing else."},{role:"user",content:`Topic keywords: ${r.join(", ")}

Article: ${e}
${t}`}],max_tokens:s.OPENAI_PARAMS.SCORE_RELEVANCE.maxTokens,temperature:s.OPENAI_PARAMS.SCORE_RELEVANCE.temperature}),i=parseInt(a.choices[0]?.message?.content||"50",10);return Math.min(100,Math.max(0,i))}catch(e){throw console.error("scoreRelevance error:",e),Error("Failed to score relevance")}}async function i(e,t,r){try{let a=e.map((e,t)=>`${t+1}. ${e.title}: ${e.summary}`).join("\n"),i=t?`Write in this style: ${t}`:"Write in a conversational, engaging tone with short paragraphs and bold key takeaways.",o=await n.chat.completions.create({model:s.OPENAI_MODELS.GPT_4O,messages:[{role:"system",content:`You are a newsletter writer for "${r||"a weekly newsletter"}". ${i}

Structure:
- Catchy headline
- Brief intro (1-2 sentences)
- 2-4 sections based on the curated articles
- Each section: subheading, 2-3 paragraphs with key insight and your take
- Brief closing with CTA

Use markdown formatting. Be concise but insightful.`},{role:"user",content:`Write a newsletter based on these curated articles:

${a}`}],max_tokens:s.OPENAI_PARAMS.GENERATE_DRAFT.maxTokens,temperature:s.OPENAI_PARAMS.GENERATE_DRAFT.temperature}),l=o.choices[0]?.message?.content||"",c=l.match(/^#\s+(.+)/m);return{title:c?c[1]:"Weekly Newsletter Draft",content:l}}catch(e){throw console.error("generateDraft error:",e),Error("Failed to generate draft")}}async function o(e,t){try{let r=await n.chat.completions.create({model:s.OPENAI_MODELS.GPT_4O_MINI,messages:[{role:"system",content:"Generate 5 email subject lines for this newsletter. Make them engaging, curiosity-driven, and under 60 characters. Return them as a numbered list."},{role:"user",content:`Title: ${e}

Content preview: ${t.slice(0,500)}`}],max_tokens:s.OPENAI_PARAMS.SUBJECT_LINES.maxTokens,temperature:s.OPENAI_PARAMS.SUBJECT_LINES.temperature});return(r.choices[0]?.message?.content||"").split("\n").filter(e=>e.trim()).map(e=>e.replace(/^\d+\.\s*/,"").trim())}catch(e){throw console.error("generateSubjectLines error:",e),Error("Failed to generate subject lines")}}async function l(e,t){try{let r=await n.chat.completions.create({model:s.OPENAI_MODELS.GPT_4O,messages:[{role:"system",content:`You are a newsletter editor. Rewrite the following newsletter content to match this writing style: ${t}

Keep the same structure, information, and key points. Only change the tone, vocabulary, and sentence style. Output the rewritten content in markdown.`},{role:"user",content:e}],max_tokens:s.OPENAI_PARAMS.REWRITE.maxTokens,temperature:s.OPENAI_PARAMS.REWRITE.temperature});return r.choices[0]?.message?.content||e}catch(e){throw console.error("rewriteInStyle error:",e),Error("Failed to rewrite content")}}async function c(e){try{let t=await n.chat.completions.create({model:s.OPENAI_MODELS.GPT_4O,messages:[{role:"system",content:"You are a newsletter editor. Condense the following newsletter content to roughly half its length. Keep the most important insights and key takeaways. Maintain the same structure (headings, sections) but make each section shorter. Output in markdown."},{role:"user",content:e}],max_tokens:s.OPENAI_PARAMS.SHORTEN.maxTokens,temperature:s.OPENAI_PARAMS.SHORTEN.temperature});return t.choices[0]?.message?.content||e}catch(e){throw console.error("makeShorter error:",e),Error("Failed to shorten content")}}async function h(e){try{let t=await n.chat.completions.create({model:s.OPENAI_MODELS.GPT_4O_MINI,messages:[{role:"system",content:"Write a concise TL;DR summary (2-3 bullet points) for this newsletter. Format as markdown with a **TL;DR** heading and bullet points. Keep it under 100 words."},{role:"user",content:e}],max_tokens:s.OPENAI_PARAMS.TLDR.maxTokens,temperature:s.OPENAI_PARAMS.TLDR.temperature});return t.choices[0]?.message?.content||""}catch(e){throw console.error("generateTldr error:",e),Error("Failed to generate TL;DR")}}e.s(["generateDraft",()=>i,"generateSubjectLines",()=>o,"generateTldr",()=>h,"makeShorter",()=>c,"rewriteInStyle",()=>l,"scoreRelevance",()=>a,"summarizeArticle",()=>r])}];

//# sourceMappingURL=Desktop_Projects_LetterFlow_bb173403._.js.map